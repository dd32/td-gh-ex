!function($){"use strict";redux.field_objects=redux.field_objects||{},redux.field_objects.media=redux.field_objects.media||{};var e;$(document).ready(function(){}),redux.field_objects.media.init=function(i){i||(i=$(document).find(".redux-group-tab:visible").find(".redux-container-media:visible")),$(i).each(function(){var i=$(this),d=i;i.hasClass("redux-field-container")||(d=i.parents(".redux-field-container:first")),d.is(":hidden")||d.hasClass("redux-field-init")&&(d.removeClass("redux-field-init"),e=!1,i.find(".remove-image, .remove-file").unbind("click").on("click",function(){redux.field_objects.media.removeFile($(this).parents("fieldset.redux-field:first"))}),i.find(".media_upload_button").unbind().on("click",function(e){redux.field_objects.media.addFile(e,$(this).parents("fieldset.redux-field:first"))}))})},redux.field_objects.media.addFile=function(i,d){i.preventDefault();var t,a=$(this),n;if(t)return void t.open();var r=$(d).find(".library-filter").data("lib-filter");void 0!==r&&""!==r&&(n=[],e=!0,r=decodeURIComponent(r),r=JSON.parse(r),$.each(r,function(e,i){n.push(i)})),t=wp.media({multiple:!1,library:{type:n},title:a.data("choose"),button:{text:a.data("update")}}),t.on("select",function(){var i=t.state().get("selection").first();t.close();var a=$(d).find(".data").data();if(("undefined"==typeof redux.field_objects.media||void 0===typeof redux.field_objects.media)&&(redux.field_objects.media={}),(void 0===a||"undefined"===a.mode)&&(a={},a.mode="image"),e===!0&&(a.mode=0),0===a.mode);else if(a.mode!==!1&&i.attributes.type!==a.mode&&i.attributes.subtype!==a.mode)return;d.find(".upload").val(i.attributes.url),d.find(".upload-id").val(i.attributes.id),d.find(".upload-height").val(i.attributes.height),d.find(".upload-width").val(i.attributes.width),redux_change($(d).find(".upload-id"));var n=i.attributes.url;if("undefined"!=typeof i.attributes.sizes&&"undefined"!=typeof i.attributes.sizes.thumbnail)n=i.attributes.sizes.thumbnail.url;else if("undefined"!=typeof i.attributes.sizes){var r=i.attributes.height;for(var o in i.attributes.sizes){var u=i.attributes.sizes[o];u.height<r&&(r=u.height,n=u.url)}}else n=i.attributes.icon;d.find(".upload-thumbnail").val(n),d.find(".upload").hasClass("noPreview")||d.find(".screenshot").empty().hide().append('<img class="redux-option-image" src="'+n+'">').slideDown("fast"),d.find(".remove-image").removeClass("hide"),d.find(".redux-background-properties").slideDown()}),t.open()},redux.field_objects.media.removeFile=function(e){if(e.find(".remove-image").addClass("hide")){e.find(".remove-image").addClass("hide"),e.find(".upload").val(""),e.find(".upload-id").val(""),e.find(".upload-height").val(""),e.find(".upload-width").val(""),e.find(".upload-thumbnail").val(""),redux_change($(e).find(".upload-id")),e.find(".redux-background-properties").hide();var i=e.find(".screenshot");i.slideUp(),e.find(".remove-file").unbind(),e.find(".section-upload .upload-notice").length>0&&e.find(".media_upload_button").remove()}}}(jQuery);