"undefined"==typeof window.panels&&(window.panels={});
jQuery(function(a){a("#panels .grid-add").button({icons:{primary:"ui-icon-columns"},text:!1}).click(function(){a("#grid-add-dialog").dialog("open");return!1});window.panels.setupGrid=function(b){a("#panels-undo-message").fadeOut(function(){a(this).remove()});b.panelsResizeCells();b.find(".grid .cell").not(".first").each(function(){a(this).resizable({handles:"w",containment:"parent",start:function(){a(this).prev().outerWidth();a(this).prev().position()},stop:function(){b.find(".grid .cell").not(".first").resizable("disable").resizable("enable")},
resize:function(){var c=a(this),e=a(this).prev();e.css("width",c.position().left-e.position().left-12);var d=0;b.find(".grid .cell").each(function(){d+=a(this).width()}).each(function(){var b=a(this).width()/d;a(this).find(".cell-width-value span").html(Math.round(1E3*b)/10+"%");a(this).attr("data-percent",b).find('input[name$="[weight]"]').val(b)});b.panelsResizeCells(!0)}})});b.find(".grid .cell .ui-resizable-handle").dblclick(function(){var c=a(this).closest(".cell"),e=c.prev(),d=Number(c.attr("data-percent"))+
Number(e.attr("data-percent"));c.attr("data-percent",d/2).find('input[name$="[weight]"]').val(d/2);e.attr("data-percent",d/2).find('input[name$="[weight]"]').val(d/2);c.add(e).find(".cell-width-value span").html(Math.round(1E3*(d/2))/10+"%");b.panelsResizeCells();return!1});b.find(".grid .cell").click(function(){a(".grid .cell").removeClass("cell-selected");a(this).addClass("cell-selected")}).each(function(){var b=Number(a(this).attr("data-percent"));a(this).find(".cell-width-value span").html(Math.round(1E3*
b)/10+"%")}).find(".panels-container").sortable({placeholder:"ui-state-highlight",connectWith:".panels-container",tolerance:"pointer",change:function(){var b=a("#panels-container .ui-state-highlight").closest(".cell").get(0);"undefined"!=typeof this.lastContainer&&this.lastContainer!=b&&(a(this.lastContainer).closest(".grid-container").panelsResizeCells(),a(b).closest(".grid-container").panelsResizeCells(),b.click());this.lastContainer=b},helper:function(a,b){return b.clone().css("opacity",0.9).addClass("panel-being-dragged")},
stop:function(){a("#panels-container .grid-container").each(function(){a(this).panelsResizeCells()})},receive:function(){a(this).trigger("refreshcells")}}).bind("refreshcells",function(){a("#panels-container .grid-container").each(function(){a(this).panelsResizeCells(!0)});a("#panels-container .panel").each(function(){var b=a(this).closest(".grid-container");a(this).find('input[name$="[info][grid]"]').val(a("#panels-container .grid-container").index(b));a(this).find('input[name$="[info][cell]"]').val(b.find(".cell").index(a(this).closest(".cell")))});
a("#panels-container .cell").each(function(){a(this).find('input[name$="[grid]"]').val(a("#panels-container .grid-container").index(a(this).closest(".grid-container")))})}).disableSelection()};a.fn.panelsResizeCells=function(){return a(this).each(function(){var b=a(this);b.find(".grid, .grid .cell .cell-wrapper").css("height","auto");var c=b.find(".grid").outerWidth();1<b.find(".grid .cell").length&&b.find(".grid .cell").each(function(){c=a(this).is(".first, .last")?c-6:c-12});var e=0,d=0;b.find(".grid .cell").each(function(){d=
Math.max(d,a(this).height());a(this).width(Math.floor(c*Number(a(this).attr("data-percent")))).css("left",e);e+=a(this).width()+12});b.find(".grid, .grid .cell .cell-wrapper").css("height",Math.max(d,68))})};var k=0,h=0;window.panels.createGrid=function(b,c){if(null==c||0==c.length){c=[];for(var e=0;e<b;e++)c[e]=1}var d=c.reduce(function(a,b){return a+b}),f=a("<div />").addClass("grid-container").appendTo("#panels-container");f.append(a('<input type="hidden" name="grids['+k+'][cells]" />').val(b));
f.append(a('<div class="controls" />').append(a("<button />").button({icons:{primary:"ui-icon-remove"},text:!1}).attr("data-tooltip",panelsLoc.buttons["delete"]).click(function(){a(this).removeTooltip();var b=[];f.find(".cell").each(function(e){b[e]={weight:Number(a(this).attr("data-percent")),widgets:[]};a(this).find(".panel").each(function(c){b[e].widgets[c]={type:a(this).attr("data-type"),data:a(this).getPanelData()}})});window.panels.undoManager.register(this,function(b,e){for(var c=[],d=0;d<
b.length;d++)c[d]=b[d].weight;c=window.panels.createGrid(c.length,c);window.panels.setupGrid(c);for(d=0;d<b.length;d++)for(var f=0;f<b[d].widgets.length;f++){var g=b[d].widgets[f],g=a("#panels-dialog").panelsCreatePanel(g.type,g.data);window.panels.addPanel(g,c.find(".panels-container").eq(d))}e!=c.index()&&(d=a("#panels-container .grid-container").eq(e),d.length&&(c.insertBefore(d),a("#panels-container").sortable("refresh"),a("#panels-container").find(".cell").each(function(){a(this).find('input[name$="[grid]"]').val(a("#panels-container .grid-container").index(a(this).closest(".grid-container")))}),
a("#panels-container .panels-container").trigger("refreshcells")));c.hide().slideDown()},[b,f.index()],"Remove Panel");a("#panels-undo-message").remove();a('<div id="panels-undo-message" class="updated"><p>'+panelsLoc.messages.deleteColumns+' - <a href="#" class="undo">'+panelsLoc.buttons.undo+"</a></p></div>").appendTo("body").hide().fadeIn().find("a.undo").click(function(){window.panels.undoManager.undo();a("#panels-undo-message").fadeOut(function(){a(this).remove()});return!1});f.slideUp(function(){f.remove();
a("#panels-container").sortable("refresh").find(".panels-container").trigger("refreshcells")});return!1})).append(a('<div class="ui-button ui-button-icon-only grid-handle"><div class="ui-icon ui-icon-move"></div></div>')));for(var g=a("<div />").addClass("grid").appendTo(f),e=0;e<b;e++){var j=a('<div class="cell" data-percent="'+c[e]/d+'"><div class="cell-wrapper panels-container"></div><div class="cell-width"><div class="cell-width-left"></div><div class="cell-width-right"></div><div class="cell-width-line"></div><div class="cell-width-value"><span></span></div></div></div>');
0==e&&j.addClass("first");e==b-1&&j.addClass("last");g.append(j);j.append(a('<input type="hidden" name="grid_cells['+h+'][weight]" />').val(c[e]/d)).append(a('<input type="hidden" name="grid_cells['+h+'][grid]" />').val(k)).data("cellId",h);h++}g.append(a("<div />").addClass("clear"));k++;return f};window.panels.clearGrids=function(){a("#panels-container .grid-container").remove()};a(window).bind("resize",function(b){a(b.target).hasClass("ui-resizable")||a("#panels-container .grid-container").panelsResizeCells()});
a("#panels-container").sortable({items:"> .grid-container",handle:".grid-handle",tolerance:"pointer",stop:function(){a(this).find(".cell").each(function(){a(this).find('input[name$="[grid]"]').val(a("#panels-container .grid-container").index(a(this).closest(".grid-container")))});a("#panels-container .panels-container").trigger("refreshcells")}});var g={};g[panelsLoc.buttons.add]=function(){var b=Number(a("#grid-add-dialog").find("input").val());if(NaN==b)return alert("Invalid Number"),!1;b=Math.round(b);
b=Math.max(1,b);b=Math.min(10,b);b=window.panels.createGrid(b);window.panels.setupGrid(b);b.hide().slideDown();a("#grid-add-dialog").dialog("close")};a("#grid-add-dialog").show().dialog({dialogClass:"panels-admin-dialog",autoOpen:!1,modal:!0,title:a("#grid-add-dialog").attr("data-title"),open:function(){a(this).find("input").val(2).select()},buttons:g}).keypress(function(b){b.keyCode==a.ui.keyCode.ENTER&&a(this).closest(".ui-dialog").find(".ui-button:eq(0)").click()});console.log("here");a("#so-panels-panels .handlediv").click(function(){setTimeout(function(){a(window).resize()},
150)})});