"undefined"==typeof window.panels&&(window.panels={});
jQuery(function(a){a("#panels .grid-add").button({icons:{primary:"ui-icon-columns"},text:!1}).click(function(){a("#grid-add-dialog").dialog("open");return!1});window.panels.setupGrid=function(b){window.panels.resizeCells(b);b.find(".grid .cell").not(".first").each(function(){a(this).resizable({handles:"w",containment:"parent",start:function(){a(this).prev().outerWidth();a(this).prev().position()},stop:function(){b.find(".grid .cell").resizable("disable").resizable("enable")},resize:function(){var c=
a(this),d=a(this).prev();d.css("width",c.position().left-d.position().left-12);var e=0;b.find(".grid .cell").each(function(){e+=a(this).width()}).each(function(){var b=a(this).width()/e;a(this).find(".cell-width-value span").html(Math.round(1E3*b)/10+"%");a(this).attr("data-percent",b).find('input[name$="[weight]"]').val(b)});window.panels.resizeCells(b,!0)}})});b.find(".grid .cell .ui-resizable-handle").dblclick(function(){var c=a(this).closest(".cell"),d=c.prev(),e=Number(c.attr("data-percent"))+
Number(d.attr("data-percent"));c.attr("data-percent",e/2).find('input[name$="[weight]"]').val(e/2);d.attr("data-percent",e/2).find('input[name$="[weight]"]').val(e/2);c.add(d).find(".cell-width-value span").html(Math.round(1E3*(e/2))/10+"%");window.panels.resizeCells(b);return!1});b.find(".grid .cell").each(function(){var b=Number(a(this).attr("data-percent"));a(this).find(".cell-width-value span").html(Math.round(1E3*b)/10+"%")}).find(".panels-container").sortable({placeholder:"ui-state-highlight",
connectWith:".panels-container",tolerance:"pointer",change:function(){window.panels.resizeCells(b,!0)},stop:function(){a("#panels-container .grid-container").each(function(){window.panels.resizeCells(a(this),!0)})},receive:function(){a(this).trigger("refreshcells")}}).bind("refreshcells",function(){window.panels.resizeCells(b);a("#panels-container .panel").each(function(){var b=a(this).closest(".grid-container");a(this).find('input[name$="[info][grid]"]').val(a("#panels-container .grid-container").index(b));
a(this).find('input[name$="[info][cell]"]').val(b.find(".cell").index(a(this).closest(".cell")))});a("#panels-container .cell").each(function(){a(this).find('input[name$="[grid]"]').val(a("#panels-container .grid-container").index(a(this).closest(".grid-container")))})}).disableSelection()};window.panels.resizeCells=function(b,c){void 0==c&&(c=!1);b.find(".grid .cell, .grid .cell-wrapper").css("height","auto");var d=b.find(".grid").outerWidth();1<b.find(".grid .cell").length&&b.find(".grid .cell").each(function(){d=
a(this).is(".first, .last")?d-6:d-12});var e=0,f=0;b.find(".grid .cell").each(function(){f=Math.max(f,a(this).outerHeight());c||(a(this).width(Math.floor(d*Number(a(this).attr("data-percent")))).css("left",e),e+=a(this).width()+12)});f=Math.max(f,50);b.find(".grid").height(f);b.find(".grid .cell .cell-wrapper").css("height",f)};var j=0,g=0;window.panels.createGrid=function(b,c){if(void 0==c){c=[];for(var d=0;d<b;d++)c[d]=1}var e=c.reduce(function(a,b){return a+b}),f=a("<div />").addClass("grid-container").appendTo("#panels-container");
f.append(a('<input type="hidden" name="grids['+j+'][cells]" />').val(b));f.append(a('<div class="controls" />').append(a("<button />").button({icons:{primary:"ui-icon-remove"},text:!1}).attr("data-tooltip",panelsLoc.buttons["delete"]).click(function(){f.css("opacity",0.25);confirm(panelsLoc.messages.confirmDeleteColumns)?f.slideUp(function(){f.remove();a("#panels-container").sortable("refresh").find(".panels-container").trigger("refreshcells")}):f.animate({opacity:1},"normal");return!1})).append(a('<div class="ui-button ui-button-icon-only grid-handle"><div class="ui-icon ui-icon-move"></div></div>')));
for(var k=a("<div />").addClass("grid").appendTo(f),d=0;d<b;d++){var h=a('<div class="cell" data-weight="1" data-percent="'+c[d]/e+'"><div class="cell-wrapper panels-container"></div><div class="cell-width"><div class="cell-width-left"></div><div class="cell-width-right"></div><div class="cell-width-line"></div><div class="cell-width-value"><span></span></div></div></div>');0==d&&h.addClass("first");d==b-1&&h.addClass("last");k.append(h);h.append(a('<input type="hidden" name="grid_cells['+g+'][weight]" />').val(c[d]/
e)).append(a('<input type="hidden" name="grid_cells['+g+'][grid]" />').val(j)).data("cellId",g);g++}k.append(a("<div />").addClass("clear"));j++;return f};window.panels.clearGrids=function(){a("#panels-container .grid-container").remove()};a(window).bind("resize",function(b){a(b.target).hasClass("ui-resizable")||a("#panels-container .grid-container").each(function(){window.panels.resizeCells(a(this))})});a("#panels-container").sortable({items:"> .grid-container",handle:".grid-handle",tolerance:"pointer",
stop:function(){a(this).find(".cell").each(function(){a(this).find('input[name$="[grid]"]').val(a("#panels-container .grid-container").index(a(this).closest(".grid-container")))});a("#panels-container .panels-container").trigger("refreshcells")}});a("#grid-add-dialog").show().dialog({dialogClass:"panels-admin-dialog",autoOpen:!1,modal:!0,title:a("#grid-add-dialog").attr("data-title"),open:function(){a(this).find("input").val(3)},buttons:{Add:function(){var b=Number(a(this).find("input").val());if(NaN==
b)return alert("Invalid Number"),!1;b=Math.round(b);b=Math.max(1,b);b=Math.min(10,b);window.panels.setupGrid(window.panels.createGrid(b));a(this).dialog("close")}}});a("#grid-add-dialog .panel-grid").click(function(){var b=a(this),c=b.attr("data-cells").split("|"),c=c.map(Number);window.panels.setupGrid(window.panels.createGrid(c.length,c,b.attr("data-type")));a("#grid-add-dialog").dialog("close")});a("#so-panels-panels .handlediv").click(function(){setTimeout(function(){a(window).resize()},150)})});