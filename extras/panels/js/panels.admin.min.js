window.panels={};
jQuery(function(a){a("#panels-dialog").show().dialog({dialogClass:"panels-admin-dialog",autoOpen:!1,resizable:!1,draggable:!1,modal:!0,title:a("#panels-dialog").attr("data-title"),minWidth:960,close:function(){a("#panels-container .panel.new-panel").hide().fadeIn(1E3).removeClass("new-panel")}}).find(".panel-type").disableSelection();a("#panels .panels-add").button({icons:{primary:"ui-icon-add"},text:!1}).click(function(){a("#panels-text-filter-input").val("").keyup();a("#panels-dialog").dialog("open");return!1});
var k=0;window.panels.undoManager=new UndoManager;a.fn.getPanelData=function(){var b=a(this),d={};b.find(".form *[name]").not("[data-info-field]").each(function(){var e=/widgets\[[0-9]+\]\[([a-z0-9_]+)\]/.exec(a(this).attr("name")),e=e[1];d[e]="checkbox"==b.attr("type")?a(this).is(":checked"):a(this).val()});return d};a.fn.panelsCreatePanel=function(b,d){var e=a(this).find('.panel-type[data-class="'+b+'"]');if(0==e.length)return null;a("#panels-undo-message").fadeOut(function(){a(this).remove()});
var f=a('<div class="panel new-panel"><div class="panel-wrapper"><div class="title"><h4></h4><span class="actions"></span></div><small class="description"></small><div class="form"></div></div></div>').attr("data-type",b),g,h=e.attr("data-form"),h=h.replace(/\{\$id\}/g,k++);f.data({"title-field":e.attr("data-title-field"),title:e.attr("data-title")}).find("h4").click(function(){g.dialog("open");return!1}).end().find(".description").html(e.find(".description").html()).end().find(".form").html(h);var j=
{},l=function(){window.panels.undoManager.register(this,function(b,d,e,f){b=a("#panels-dialog").panelsCreatePanel(b,d,e);window.panels.addPanel(b,e,f,!0)},[f.attr("data-type"),f.getPanelData(),f.closest(".panels-container"),f.index()],"Remove Panel");a("#panels-undo-message").remove();a('<div id="panels-undo-message" class="updated"><p>'+panelsLoc.messages.deleteWidget+' - <a href="#" class="undo">'+panelsLoc.buttons.undo+"</a></p></div>").appendTo("body").hide().slideDown().find("a.undo").click(function(){window.panels.undoManager.undo();
a("#panels-undo-message").fadeOut(function(){a(this).remove()});return!1});f.slideUp(function(){a(this).remove();a("#panels-container .panels-container").trigger("refreshcells")});g.dialog("close")};j[panelsLoc.buttons.done]=function(){a(this).trigger("panelsdone");g.find("*[name]").not("[data-info-field]").each(function(){var b=f.find('.form *[name="'+a(this).attr("name")+'"]');"checkbox"==b.attr("type")?b.prop("checked",a(this).is(":checked")):b.val(a(this).val())});f.panelsSetPanelTitle();g.dialog("close")};
g=a('<div class="dialog-form"></div>').html(h).dialog({dialogClass:"panels-admin-dialog",autoOpen:!1,modal:!0,title:"Edit %s Panel".replace("%s",e.attr("data-title")),minWidth:700,create:function(){a(this).closest(".ui-dialog").find(".show-in-panels").show()},open:function(){f.find(".form *[name]").not("[data-info-field]").each(function(){var b=g.find('*[name="'+a(this).attr("name")+'"]');"checkbox"==b.attr("type")?b.prop("checked",a(this).is(":checked")):b.val(a(this).val())});a(this).trigger("panelsopen");
a(this).closest(".ui-dialog").find("a").blur()},buttons:j});g.find("label").each(function(){var b=a("#"+a(this).attr("for"));a(this).disableSelection();a(this).click(function(){"checkbox"==b.attr("type")?b.prop("checked",!b.prop("checked")):b.focus()})});f.disableSelection();f.find(".title .actions").append(a("<a>edit<a>").addClass("edit").click(function(){g.dialog("open");return!1})).append(a("<a>delete<a>").addClass("delete").click(function(){l();return!1}));if(void 0!=d)for(c in d)"info"!=c&&(e=
f.find('.form *[name$="['+c+']"]'),h=g.find('*[name$="['+c+']"]'),"checkbox"==e.attr("type")?(e.prop("checked",Boolean(d[c])),h.prop("checked",Boolean(d[c]))):(e.val(d[c]),h.val(d[c])));f.panelsSetPanelTitle();a(window).resize();return f};window.panels.addPanel=function(b,d,e,f){null==d&&(d=a("#panels-container .cell.cell-selected .panels-container").eq(0));0==d.length&&(d=a("#panels-container .cell .panels-container").eq(0));0!=d.length&&(null==e?d.append(b):(e=d.find(".panel").eq(e),0==e.length?
d.append(b):b.insertBefore(e)),d.sortable("refresh").trigger("refreshcells"),d.closest(".grid-container").panelsResizeCells(),f&&a("#panels-container .panel.new-panel").hide().fadeIn(1E3).removeClass("new-panel"))};a.fn.panelsSetPanelTitle=function(){return a(this).each(function(){var b=a(this).data("title-field"),d;void 0!=b&&(d=a(this).find('*[name$="['+b+']"]').val());""==d||void 0==d?a(this).find("h4").html(a(this).data("title")):a(this).find("h4").html(a(this).data("title")+": "+d)})};a("#panels-text-filter-input").keyup(function(){var b=
a(this).val();a("#panels-dialog .panel-type-list .panel-type").show().each(function(){""!=b&&-1==a(this).find("h3").html().toLowerCase().indexOf(b)&&a(this).hide()})}).click(function(){a(this).keyup()});a("#panels-dialog .panel-type").click(function(){var b=a("#panels-dialog").panelsCreatePanel(a(this).attr("data-class"));window.panels.addPanel(b,null,null,!0);a("#panels-dialog").dialog("close")});window.panels.loadPanels=function(b){window.panels.clearGrids();for(var d in b.grids){var e=[],f;for(f in b.grid_cells)Number(b.grid_cells[f].grid)==
d&&(e[e.length]=Number(b.grid_cells[f].weight));e=window.panels.createGrid(Number(b.grids[d].cells),e);window.panels.setupGrid(e);for(var g in b.widgets)if(Number(b.widgets[g].info.grid)==d){var h=b.widgets[g],h=a("#panels-dialog").panelsCreatePanel(h.info["class"],h);e.find(".panels-container").eq(Number(b.widgets[g].info.cell)).append(h)}}a("#panels-container .panels-container").sortable("refresh").trigger("refreshcells");a("#panels-container .panel").removeClass("new-panel");a("#panels-container .grid-container").each(function(){a(this).panelsResizeCells()})};
"undefined"!=typeof panelsData?window.panels.loadPanels(panelsData):window.panels.setupGrid(window.panels.createGrid(1));a(window).resize(function(){a(".panels-admin-dialog").filter(":data(dialog)").dialog("option","position","center")});a("#wp-content-editor-tools").find(".wp-switch-editor").click(function(){a(this);a("#wp-content-editor-container, #post-status-info").show();a("#so-panels-panels").hide();a("#wp-content-wrap").removeClass("panels-active");a("#content-resize-handle").show()}).end().prepend(a('<a id="content-panels" class="hide-if-no-js wp-switch-editor switch-panels">'+
a("#so-panels-panels h3.hndle span").html()+"</a>").click(function(){a(this);a("#wp-content-wrap").removeClass("tmce-active html-active");a("#wp-content-editor-container, #post-status-info").hide();a("#so-panels-panels").show();a("#wp-content-wrap").addClass("panels-active");a(window).resize();a("#content-resize-handle").hide();return!1}));a("#wp-content-editor-tools .wp-switch-editor").click(function(){var b=a(this).attr("id").split("-");a("#wp-content-wrap").addClass(b[1]+"-active")});a("#panels-home-page #post-body").show();
a("#panels-home-page #post-body-wrapper").css("background","none");a("#so-panels-panels").insertAfter("#wp-content-editor-container").addClass("wp-editor-container").hide().find(".handlediv").remove().end().find(".hndle").html("").append(a("#add-to-panels"));a("#content-panels").click(function(){a(window).resize()});("undefined"!=typeof panelsData||a("#panels-home-page").length)&&a("#content-panels").click();setTimeout(function(){("undefined"!=typeof panelsData||a("#panels-home-page").length)&&a("#content-panels").click();
a("#so-panels-panels .hndle").unbind("click");a("#so-panels-panels .cell").eq(0).click()},150);a("#panels-home-page").length&&(a("#content-tmce, #content-html").remove(),a("#content-panels").hide())});